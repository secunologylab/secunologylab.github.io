---
layout: post
title: "클라우드 네이티브 보안 이야기"
author: Jo Ja-il (Tribal)
date: 2021-04-13 13:40:00
categories: Kubernetes
img: 4.png
---

클라우드 서비스가 많아지면서 클라우드 보안도 필요하다는 말이 나오기 시작한 지도 벌써 오래되었다. 하지만 클라우드 보안이라고 해도 막상 잘 모르는 분야이기도 하고 관심을 별로 안 가지던 분야이기 때문에 클라우드 보안이 어떤 것인지 아는 사람은 많지 않다고 생각한다.

그래서 이 글은 클라우드 보안이 어떤 것인지 Kubernetes에서 정리한 클라우드 네이티브 보안 개요라는 글을 기반으로 작성하고자 한다.

<br />

## 클라우드 보안

클라우드 보안은 굉장히 넓은 범위의 보안을 포괄적으로 담고 있는 용어이고 클라우드 서비스 유형에 따라 서비스 제공자와 서비스 사용자가 보안을 담당할 범위가 달라지기 때문에 클라우드 보안을 어떻게 해야 한다고 단정하기 어렵다.

따라서 클라우드 보안 계층을 통해 클라우드 서비스에 존재하는 다양한 보안 요소들을 살펴보고, 서비스 유형에 맞춰서 어떻게 관리해야 할지를 목록화 해보고자 한다.

<br />

### 클라우드 네이티브 보안 4 계층

클라우드에서 보안은 4 계층으로 이루어진다. 클라우드(Cloud), 클러스터(Cluster), 컨테이너(Container), 코드(Code)로 이루어지며, 이 4개의 계층은 C로 시작하기 때문에 4C라고도 한다.

<div class="img-in-post">
<img src="/images/4/1.png" />
[그림 1] 클라우드 네이티브 보안 4 계층
</div>

1 계층에 가까울수록 보안 범위가 증가하며, 침해 사고로 발생하는 파급력이 커진다. 그렇다고 하위 계층을 방치하면 해킹 공격의 가능성을 열어두게 되므로 이에 대해서도 보안에 신경을 써야 한다. 

1 계층을 클라우드 보안이라고 명칭하기 때문에 용어 혼동을 피하기 위해 4개의 계층을 묶어 클라우드 네이티브 보안이라고 명칭한다.

#### 클라우드 보안 (1 계층)

클라우드 보안은 제공되는 클라우드 서비스와 클라우드 서비스 위에 올라가는 인프라를 보안상 어떤 식으로 구성할지를 기획하는 계층이다. 그래서 클라우드 공급자가 클라우드 서비스를 제공하기 위한 클라우드 공급자 보안과, 인프라를 어떤 식으로 구성할지를 결정하는 인프라스트럭쳐 보안으로 나뉜다.

클라우드 공급자인 AWS, GCP, Azure 등의 서비스 플랫폼과 인프라 구상 자체가 클라우드 보안에서 다루는 대상이다.

-   **클라우드 공급자 보안** : 클라우드 공급자가 제공하는 서비스 플랫폼의 리소스에 대한 보안이다. 서비스 플랫폼에서 추가로 제공하는 서비스나 솔루션으로 IAM, 로깅, 모니터링, 웹 방화벽, 취약점 진단 등이 여기에 해당한다. 컴퓨터 소프트웨어의 취약점을 찾을 때 하드웨어에 대해서는 무조건 신뢰한다고 가정하고 접근하듯이, 클라우드 공급자 역할을 하는 기업에서 일하는 게 아니라면 접근하기 어려운 영역이기 때문에 신뢰 컴퓨팅 기반(Trusted computing base)으로 이루어진다. 이 부분을 연구하고자 한다면 OpenStack과 같은 오픈 소스 등을 보며 연구하면 될 것 같다.
-   **인프라스트럭처 보안** : 인프라를 구성하는 각 구성 요소들의 보안 설계를 말하며, 일반적인 네트워크 인프라 보안을 클라우드가 도입되면서 확장시킨 형태이다. 기업에서 인프라를 구성할 때 그냥 구성하는게 아니라 인프라 내부에서 서비스에 따라 적절한 위치를 배분한다. 외/내부망 및 DMZ 존을 나누고, 각 망들의 연결 지점에 방화벽, 라우터 등을 배치한다.

#### 클러스터 보안 (2 계층)

2 계층은 인프라를 구성할 때 직접 손으로 구성하지 않고 컨테이너 오케스트레이션 도구를 사용하여 클러스터를 구축하게 되는데 이 때 구축하는 클러스터에 대한 보안을 다룬다. 클러스터에는 클러스터를 운영하기 위해 필요한 기본 구성 요소와 인프라 구성에 따라 클러스터에 추가되는 요소가 있다. 클러스터를 운영하기 위해 필요한 기본 구성 요소들에 대한 보안을 클러스터 보안이라고 하고, 구성에 따라 서비스를 제공하기 위해 추가되는 요소들에 대한 보안을 워크로드 보안이라고 한다.

컨테이너 오케스트레이션 도구인 Kubernetes, Docker Swarm, RedHat Ansible 등으로 구성되는 클러스터 전체가 대상이다.

-   **클러스터 보안** : 클러스터를 운영하기 위해 필요한 기본 구성 요소들에 대한 보안이다. 여러 서버를 동시에 운영하기 위해서는 서버 간 통신이 필요하고 이에 따른 기본 구성 요소들이 반드시 존재한다. 기본 구성 요소들은 클러스터의 운영과 관련 있기 때문에 무분별한 접근이 발생하면 클러스터 전체에 영향을 끼치는 문제가 발생할 수 있다. 또한 기본 구성 요소들은 방대한 설정 옵션을 가지고 있어 클러스터 상황에 맞춰 설정을 하게 되면 잘못된 설정 미스가 발생할 수 있다. 따라서 각 기본 구성 요소별 적절한 옵션을 확인하고 사용해야 한다.
-   **워크로드 보안** : 클러스터에서 서비스로 어플리케이션을 구동하면 1개 이상의 컨테이너가 생성되고, 클러스터의 구성 요소로 추가된다. 클러스터를 관리하는 측면에서 이러한 작은 구성 요소 하나하나를 직접 보면서 관리하지 않기 때문에 예상할 수 없는 상황이 발생할 수 있다. 이러한 예상할 수 없는 상황에 대비하여 클러스터를 더욱 견고하게 만드는 보안이 워크로드 보안이다. 워크로드 보안 설정은 쿠버네티스 기준으로 RBAC, Pod-Security-Policy, 네트워크 정책, 인증 등이 있다.

#### 컨테이너 보안 (3 계층)

3 계층은 클라우드 클러스터의 핵심인 컨테이너에 대한 보안을 말한다. 컨테이너는 호스트의 자원을 격리하고 컨테이너 이미지로 컨테이너를 구동한다. 컨테이너에 취약점이 있거나 컨테이너 이미지에 문제가 있는 경우, 외부에서 컨테이너로 접근할 수 있도록 허용할 수 있다.

컨테이너 내부 환경과 컨테이너 런타임 도구인 Docker, containerd, CRI-O 등이 컨테이너 보안의 대상이다.

#### 코드 보안 (4 계층)

4 계층은 서비스를 제공하기 위해 프로그래밍 언어로 작성된 바이너리나 웹 페이지 등에 대한 보안을 말한다. 일반적으로 하고 있는 기술적 보안(소프트웨어나 웹에서 발생하는 취약점 등)이 여기에 속한다. 때문에 해당 계층은 클라우드 보안 계층으로 설명하고 있지만 꼭 클라우드 보안에만 포함되지는 않는다.

<br />

### 클라우드 서비스 유형별 보안

클라우드 서비스는 서비스 제공자가 제공하는 자원에 따라 클라우드 서비스 유형이 나뉜다. 클라우드 서비스 유형과 제공되는 자원은 다음과 같다.

<div class="img-in-post">
<img src="/images/4/2.png" />
[그림 2] 클라우드 서비스 유형별 보안 책임
</div>

-   On-Premise : 줄여서 On-Prem, 직접 클라우드를 구축하여 사용
-   IaaS(Infrastructure as a Service) : 사용자가 VM까지만 제공받고, 직접 OS를 올려 사용
-   CaaS(Container as a Service) : 사용자가 컨테이너 런타임까지 제공받고, 컨테이너 이미지로 컨테이너들을 사용
-   PaaS(Platform as a Service) : 사용자가 런타임(node.js, java, python 등)이 설치된 컨테이너를 제공받아, 어플리케이션을 작성하는 코드만 사용
-   FaaS(Function as a Service) : 사용자가 특별한 서버 없이 특정 이벤트 발생 시 실행되는 함수만 등록하여 사용
-   SaaS(Software as a Service) : 사용자가 클라우드에 등록된 소프트웨어를 바로 사용

<br />

사용자는 클라우드 서비스 유형에 따라 서비스 제공자로부터 제공받는 자원에 대해서만 관리하면 된다. 보안은 당연히 관리하는 자원에 대해서만 하면 되고, 제공받은 자원에 대해서는 클라우드 서비스 제공자 측에서 관리하고 책임을 진다.

클라우드 서비스 유형에 표시된 각 자원을 클라우드 보안 4 계층에 적용하면 아래와 같은 그림이 나온다. 해당 그림에는 좀 더 세분화된 내용이 빠졌기 때문에 실제로 계층이 그림처럼 깔끔하게 나눠지진 않으므로 각 계층과 자원에 대한 확실한 지식이 요구된다.

<div class="img-in-post">
<img src="/images/4/3.png" />
[그림 3] 클라우드 계층에 따른 서비스 자원 책임 영역
</div>

1 계층인 클라우드 보안은 VM을 제공하기 위한 가상화, 클라우드 서비스가 이루어지는 서버, VM 등에 대한 정보를 저장하는 저장소, 네트워크 보안과 실제 서버의 물리적 보안까지를 다룬다. On-Prem 으로 클라우드 인프라를 구축하여 사용하는 사용자가 아니라면 클라우드 서비스 제공자 측에서 이에 대한 관리와 보안을 책임진다. 이에 대한 책임으로 클라우드 서비스 시장에 Trusted Computing Base를 만든다.

2 계층인 클러스터 보안은 컨테이너 런타임이 설치된 호스트 OS와 클러스터의 구성 요소인 컨테이너들에 대한 보안을 다룬다. On-Prem이나 IaaS로 직접 클러스터를 구축하여 사용하였다면 클라우드 서비스 제공자 측에서 책임을 진다.

3 계층인 컨테이너 보안은 격리된 컨테이너에 대한 보안을 다룬다. 2 계층과 동일하게 On-Prem이나 IaaS에 대해서는 클라우드 서비스 제공자가 확실한 책임을 가지며, CaaS로 구축된 클러스터에 대해서는 일부에 대한 책임만을 가지므로 사용자도 이에 대한 관리와 보안을 해야 한다.

4 계층인 코드 보안은 사용자가 작성한 프로그램 코드에 대한 보안을 말한다. PaaS, FaaS, SaaS 유형의 클라우드를 사용하는 게 아니라면 사용자가 관리와 보안에 대한 모든 책임을 가져야 한다.

<br />

## 결론

해외에서는 오래전부터 클라우드 보안 연구가 계속 진행되었기 때문에 클라우드 보안 연구 자료가 많고 보안을 어떻게 체계적으로 할지에 대한 글을 많이 찾을 수 있었다. 하지만 국내에서는 아직 클라우드 보안 연구가 준비되고 있어 클라우드 연구 자료를 찾아보기 어려웠다. 따라서 클라우드 네이티브 보안에 대한 글과 연구가 더 많이 작성되어 국내에도 더욱 신뢰성 있는 클라우드 시장이 활성화되면 좋겠다고 생각한다.

<br />

## 문의

Secunology Labs는 클라우드의 광범위한 인프라에서 발생 가능한 다양한 유형의 취약점을 미리 연구하고 있습니다. 클라우드 보안 연구를 바탕으로 준비된 교육에 관심있으신 분들은 **[클라우드 페이지](https://secunologylab.com/cloud)**를 확인해주세요.

**이메일 : snlcloud@secunologylab.com**

<br />

## 참고

-   Kubernetes 클라우드 네이티브 보안 개요 : [kubernetes.io/ko/docs/concepts/security/overview/](https://kubernetes.io/ko/docs/concepts/security/overview/)
-   구글 인프라 보안 설계 : [cloud.google.com/security/infrastructure/design](https://cloud.google.com/security/infrastructure/design)
-   클라우드 서비스 유형 : [www.redhat.com/ko/topics/cloud-computing/iaas-vs-paas-vs-saas](https://www.redhat.com/ko/topics/cloud-computing/iaas-vs-paas-vs-saas)